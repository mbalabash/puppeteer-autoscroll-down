<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Async content page</title>
    <style>
      .hide {
        display: none;
      }
    </style>
  </head>
  <body>
    <h1>Lorem Ipsum</h1>
    <h4>
      <em
        >"Neque porro quisquam est qui dolorem ipsum quia dolor sit amet, consectetur, adipisci
        velit..." "There is no one who loves pain itself, who seeks after it and wants to have it,
        simply because it is pain..."</em
      >
    </h4>

    <p id="content">
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin condimentum pharetra tellus,
      sit amet ullamcorper tellus mollis at. Integer eget aliquet ligula, at maximus tellus.
      Suspendisse sed sollicitudin nibh. Mauris volutpat accumsan tortor sed cursus. Class aptent
      taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Nullam gravida
      odio nisl, sed luctus dui hendrerit ac. Vivamus auctor tempor nisl non hendrerit. Nullam vitae
      mauris sed sem efficitur molestie. Quisque hendrerit est augue. Vestibulum ac feugiat dolor.
      Donec a tincidunt orci, vitae condimentum turpis. Phasellus in ullamcorper justo, a
      pellentesque lectus. Morbi luctus tortor nec metus tincidunt, in pellentesque lacus iaculis.
      Aliquam sit amet leo mi. Sed ultricies neque ut egestas rhoncus. Morbi egestas leo sed orci
      ullamcorper, eget sagittis ex malesuada. Fusce finibus, ex blandit elementum tincidunt, velit
      mauris imperdiet quam, a bibendum nulla quam in magna. Donec fringilla leo ligula, a viverra
      sem sollicitudin nec. Etiam dapibus iaculis lacus id volutpat. Quisque vestibulum metus sit
      amet leo sodales condimentum. Aenean elementum porttitor sem nec laoreet. Nam blandit tempor
      enim sit amet accumsan. Etiam fringilla odio mi, ullamcorper pulvinar arcu dictum ut. Maecenas
      bibendum aliquet pulvinar. Duis id magna sit amet ipsum elementum cursus sit amet in mauris.
      Morbi vulputate, lorem ac euismod ullamcorper, justo neque gravida risus, convallis porta
      ligula sapien nec ex. Fusce at dictum massa. In mi neque, interdum et tempor maximus,
      elementum placerat sem. Nam iaculis augue sit amet ante tincidunt porta. Aenean non elit
      porta, gravida ex eget, consectetur nisl. Duis eu ullamcorper justo, sit amet finibus dolor.
      Donec varius varius metus, sit amet maximus mi interdum non. Duis ut orci justo. Aenean quis
      libero viverra, fermentum nulla quis, auctor diam. Proin at sem et purus eleifend porttitor a
      ac turpis. Duis lacinia sed mi a fermentum. Donec in aliquam sem. In venenatis condimentum
      risus, nec fringilla metus egestas eget. Sed odio nisl, condimentum id nisl et, luctus
      bibendum urna. In hac habitasse platea dictumst. Nunc sit amet nulla metus. Morbi ac viverra
      tellus, id ultrices nisi. Sed faucibus odio pulvinar ipsum molestie, congue bibendum erat
      venenatis. Cras bibendum felis gravida hendrerit imperdiet. Nam scelerisque lectus ac tempus
      ultrices. Vivamus lorem tortor, volutpat quis aliquam porttitor, iaculis et dui. In id nulla
      in purus placerat facilisis nec pulvinar eros. Phasellus blandit mattis quam sit amet mollis.
      Donec mollis est lacus, vel aliquam eros gravida a. Nunc pulvinar viverra lacus sit amet
      feugiat. Integer nec metus egestas, varius urna eu, cursus eros. Proin pulvinar tempus
      ultricies. Fusce gravida nisi odio, non placerat nunc euismod nec. Nam eros massa, ornare
      consectetur accumsan quis, imperdiet eu erat. In sit amet eros elit. Donec scelerisque tortor
      sit amet neque interdum, at fermentum eros laoreet. Vestibulum vulputate posuere sapien ac
      rhoncus. Nulla ac vulputate libero. Nam non elementum augue, vel iaculis libero. Nulla
      ultricies lobortis neque, a euismod felis mollis nec. Phasellus vel magna ut nunc tempor
      malesuada. Donec diam purus, venenatis id eleifend sit amet, dictum quis felis. Donec commodo
      nibh augue, pharetra volutpat odio varius eu. Duis aliquet neque sed tortor ultricies, vitae
      molestie erat tempus. Donec id sodales enim, dapibus imperdiet risus. Fusce eget dolor at eros
      auctor elementum. Duis consequat scelerisque turpis, vel vehicula est semper fermentum. Nullam
      molestie dignissim libero. Maecenas eu nisi in nulla accumsan suscipit a nec leo. Sed ultrices
      neque non efficitur imperdiet. Morbi consectetur libero finibus rhoncus consectetur.
      Vestibulum eget volutpat tellus. Suspendisse at arcu semper, dapibus ex nec, cursus tortor.
      Vivamus scelerisque ornare porttitor. Aliquam porttitor nisl ex. Maecenas et cursus nisi, a
      rutrum justo. Sed at mattis ex, vel vulputate velit. Ut ut metus sit amet mauris placerat
      aliquet. Ut magna turpis, luctus vitae euismod tempor, vestibulum vitae nisl. Mauris sodales
      vulputate dapibus. Duis leo nunc, pretium interdum quam vel, fermentum porttitor ex. Maecenas
      commodo lectus non consequat tincidunt. Praesent eget lectus eu justo vulputate placerat et
      condimentum sem. Cras luctus mi ac orci ornare maximus sed et sem. Aenean lectus neque,
      elementum eu quam eu, tincidunt dignissim ante. Maecenas ipsum mi, accumsan mattis volutpat
      in, pulvinar in nisl. Interdum et malesuada fames ac ante ipsum primis in faucibus. Nam
      porttitor imperdiet orci in varius. Curabitur lacinia at neque non placerat. Sed ullamcorper
      porta quam vel sollicitudin. Aliquam turpis nisi, ultricies ac risus eget, lobortis egestas
      mi. Morbi hendrerit, elit nec accumsan commodo, mi sapien posuere ante, et mattis diam lectus
      et lectus. Mauris blandit sem vel turpis accumsan, sed hendrerit magna semper. Nunc in ex
      justo. Proin consequat eleifend lobortis. Quisque vel molestie nulla, et volutpat magna. Lorem
      ipsum dolor sit amet, consectetur adipiscing elit. Praesent eget nisl leo. Sed vitae vehicula
      felis. Duis in ullamcorper felis. Nulla vitae dui tempor, varius nibh at, varius odio. Sed
      ultricies dolor ut venenatis accumsan. Fusce dictum, arcu at placerat pellentesque, purus
      lacus laoreet dolor, ut pellentesque arcu lorem eu augue. Nunc vulputate maximus eros, vitae
      mattis massa scelerisque eu. Aenean porttitor imperdiet rhoncus. Vestibulum nec neque semper,
      blandit est vitae, molestie purus. Pellentesque habitant morbi tristique senectus et netus et
      malesuada fames ac turpis egestas. Etiam interdum ullamcorper sollicitudin. Mauris risus
      neque, molestie lobortis erat sit amet, sagittis finibus neque. Aenean a mauris mattis,
      aliquam turpis at, eleifend metus. Aliquam ac quam faucibus, rhoncus turpis eu, lobortis est.
      Quisque scelerisque faucibus est, id malesuada justo efficitur congue. Ut venenatis sem sit
      amet orci vulputate, at ornare nisi venenatis. Quisque a viverra nisl. Suspendisse varius,
      tortor vitae condimentum ullamcorper, tortor nibh sodales massa, a euismod libero nibh sit
      amet mi.
    </p>

    <strong id="loader">Loading...</strong>

    <strong id="test" class="hide"
      >This should be in viewport if page fully scrolled to bottom.</strong
    >

    <script>
      let countOfDataChunksLoaded = 0
      let delay = ms => new Promise(resolve => setTimeout(resolve, ms))

      function isInViewport(element) {
        const rect = element.getBoundingClientRect()
        return (
          rect.top >= 0 &&
          rect.left >= 0 &&
          rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
          rect.right <= (window.innerWidth || document.documentElement.clientWidth)
        )
      }

      function dataLoader(entries) {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            delay(1234).then(() => {
              countOfDataChunksLoaded += 1
              document
                .querySelector('#content')
                .appendChild(
                  document.createTextNode(
                    'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin condimentum pharetra tellus, sit amet ullamcorper tellus mollis at. Integer eget aliquet ligula, at maximus tellus. Suspendisse sed sollicitudin nibh. Mauris volutpat accumsan tortor sed cursus. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Nullam gravida odio nisl, sed luctus dui hendrerit ac. Vivamus auctor tempor nisl non hendrerit. Nullam vitae mauris sed sem efficitur molestie. Quisque hendrerit est augue. Vestibulum ac feugiat dolor. Donec a tincidunt orci, vitae condimentum turpis. Phasellus in ullamcorper justo, a pellentesque lectus. Morbi luctus tortor nec metus tincidunt, in pellentesque lacus iaculis. Aliquam sit amet leo mi. Sed ultricies neque ut egestas rhoncus. Morbi egestas leo sed orci ullamcorper, eget sagittis ex malesuada. Fusce finibus, ex blandit elementum tincidunt, velit mauris imperdiet quam, a bibendum nulla quam in magna. Donec fringilla leo ligula, a viverra sem sollicitudin nec. Etiam dapibus iaculis lacus id volutpat. Quisque vestibulum metus sit amet leo sodales condimentum. Aenean elementum porttitor sem nec laoreet. Nam blandit tempor enim sit amet accumsan. Etiam fringilla odio mi, ullamcorper pulvinar arcu dictum ut. Maecenas bibendum aliquet pulvinar. Duis id magna sit amet ipsum elementum cursus sit amet in mauris. Morbi vulputate, lorem ac euismod ullamcorper, justo neque gravida risus, convallis porta ligula sapien nec ex. Fusce at dictum massa. In mi neque, interdum et tempor maximus, elementum placerat sem. Nam iaculis augue sit amet ante tincidunt porta. Aenean non elit porta, gravida ex eget, consectetur nisl. Duis eu ullamcorper justo, sit amet finibus dolor. Donec varius varius metus, sit amet maximus mi interdum non. Duis ut orci justo. Aenean quis libero viverra, fermentum nulla quis, auctor diam. Proin at sem et purus eleifend porttitor a ac turpis. Duis lacinia sed mi a fermentum. Donec in aliquam sem. In venenatis condimentum risus, nec fringilla metus egestas eget. Sed odio nisl, condimentum id nisl et, luctus bibendum urna. In hac habitasse platea dictumst. Nunc sit amet nulla metus. Morbi ac viverra tellus, id ultrices nisi. Sed faucibus odio pulvinar ipsum molestie, congue bibendum erat venenatis. Cras bibendum felis gravida hendrerit imperdiet. Nam scelerisque lectus ac tempus ultrices. Vivamus lorem tortor, volutpat quis aliquam porttitor, iaculis et dui. In id nulla in purus placerat facilisis nec pulvinar eros. Phasellus blandit mattis quam sit amet mollis. Donec mollis est lacus, vel aliquam eros gravida a. Nunc pulvinar viverra lacus sit amet feugiat. Integer nec metus egestas, varius urna eu, cursus eros. Proin pulvinar tempus ultricies. Fusce gravida nisi odio, non placerat nunc euismod nec. Nam eros massa, ornare consectetur accumsan quis, imperdiet eu erat. In sit amet eros elit. Donec scelerisque tortor sit amet neque interdum, at fermentum eros laoreet. Vestibulum vulputate posuere sapien ac rhoncus. Nulla ac vulputate libero. Nam non elementum augue, vel iaculis libero. Nulla ultricies lobortis neque, a euismod felis mollis nec. Phasellus vel magna ut nunc tempor malesuada. Donec diam purus, venenatis id eleifend sit amet, dictum quis felis. Donec commodo nibh augue, pharetra volutpat odio varius eu. Duis aliquet neque sed tortor ultricies, vitae molestie erat tempus. Donec id sodales enim, dapibus imperdiet risus. Fusce eget dolor at eros auctor elementum. Duis consequat scelerisque turpis, vel vehicula est semper fermentum. Nullam molestie dignissim libero. Maecenas eu nisi in nulla accumsan suscipit a nec leo. Sed ultrices neque non efficitur imperdiet. Morbi consectetur libero finibus rhoncus consectetur. Vestibulum eget volutpat tellus. Suspendisse at arcu semper, dapibus ex nec, cursus tortor. Vivamus scelerisque ornare porttitor. Aliquam porttitor nisl ex. Maecenas et cursus nisi, a rutrum justo. Sed at mattis ex, vel vulputate velit. Ut ut metus sit amet mauris placerat aliquet. Ut magna turpis, luctus vitae euismod tempor, vestibulum vitae nisl. Mauris sodales vulputate dapibus. Duis leo nunc, pretium interdum quam vel, fermentum porttitor ex. Maecenas commodo lectus non consequat tincidunt. Praesent eget lectus eu justo vulputate placerat et condimentum sem. Cras luctus mi ac orci ornare maximus sed et sem. Aenean lectus neque, elementum eu quam eu, tincidunt dignissim ante. Maecenas ipsum mi, accumsan mattis volutpat in, pulvinar in nisl. Interdum et malesuada fames ac ante ipsum primis in faucibus. Nam porttitor imperdiet orci in varius. Curabitur lacinia at neque non placerat. Sed ullamcorper porta quam vel sollicitudin. Aliquam turpis nisi, ultricies ac risus eget, lobortis egestas mi. Morbi hendrerit, elit nec accumsan commodo, mi sapien posuere ante, et mattis diam lectus et lectus. Mauris blandit sem vel turpis accumsan, sed hendrerit magna semper. Nunc in ex justo. Proin consequat eleifend lobortis. Quisque vel molestie nulla, et volutpat magna. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent eget nisl leo. Sed vitae vehicula felis. Duis in ullamcorper felis. Nulla vitae dui tempor, varius nibh at, varius odio. Sed ultricies dolor ut venenatis accumsan. Fusce dictum, arcu at placerat pellentesque, purus lacus laoreet dolor, ut pellentesque arcu lorem eu augue. Nunc vulputate maximus eros, vitae mattis massa scelerisque eu. Aenean porttitor imperdiet rhoncus. Vestibulum nec neque semper, blandit est vitae, molestie purus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Etiam interdum ullamcorper sollicitudin. Mauris risus neque, molestie lobortis erat sit amet, sagittis finibus neque. Aenean a mauris mattis, aliquam turpis at, eleifend metus. Aliquam ac quam faucibus, rhoncus turpis eu, lobortis est. Quisque scelerisque faucibus est, id malesuada justo efficitur congue. Ut venenatis sem sit amet orci vulputate, at ornare nisi venenatis. Quisque a viverra nisl. Suspendisse varius, tortor vitae condimentum ullamcorper, tortor nibh sodales massa, a euismod libero nibh sit amet mi.'
                  )
                )
            })
          }
          if (countOfDataChunksLoaded === 5) {
            document.querySelector('#test').classList.remove('hide')
            document.querySelector('#loader').classList.add('hide')
          }
        })
      }

      let observer = new IntersectionObserver(dataLoader, {
        root: null,
        rootMargin: '0px',
        threshold: 1.0
      })

      observer.observe(document.querySelector('#loader'))
    </script>
  </body>
</html>
